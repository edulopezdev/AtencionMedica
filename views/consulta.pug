doctype html
html
  head
    title Formulario de Evolución del Paciente
    link(href="https://cdn.lineicons.com/4.0/lineicons.css", rel="stylesheet")
    link(href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css", rel="stylesheet")
    link(rel="stylesheet" href="css/styles.css")
    script(src="/js/frontConsulta.js") // Archivo JS para manejo dinámico
  body
    .container-fluid(style="background-image: url('images/background_modulos.png'); background-size: cover; background-attachment: fixed; min-height: 100vh;")
      .row
        .col-md-1
          include sidebar.pug

        .col-md-9.mx-auto
          .main.p-3(style="margin: auto;")
            .row.justify-content-center
              .col-md-12 
                h1.text-center Consulta actual
                if turno
                  .card.mb-4.custom-bg
                    .card-body.no-hover
                      .row
                        .col-md-6
                          h2.text-center Datos del Paciente
                          .text-center
                            p Nombre: #{turno.nombre}
                            p Apellido: #{turno.apellido}
                            p Motivo consulta: #{turno.motivo_consulta}
                        .col-md-6
                          h2.text-center Última visita
                          .text-center
                            if ultimoTurno
                              - var fecha = new Date(ultimoTurno.fecha);
                              - var dia = String(fecha.getDate()).padStart(2, '0');
                              - var mes = String(fecha.getMonth() + 1).padStart(2, '0'); // Los meses son 0-indexed
                              - var anio = fecha.getFullYear();
                              p Fecha: #{dia}-#{mes}-#{anio}
                              p Resumen: #{ultimoTurno.resumen_diagnostico}.
                              a.btn-hce.mt-3(href="/hce") Ir a HCE del paciente
                            else
                              p Esta es la primera visita del paciente

                else
                  p No se encontraron datos del paciente.

                // Separación adicional entre los datos del paciente y el formulario
                .col-md-12.mt-5
                  h2.text-center Formulario de Evolución
                  form(action="/submit" method="POST")
                    .mb-3
                      label(for="template", class="form-label") Template evolución:
                      select#template.form-select(name="template")
                          option(value="") Seleccionar template
                          each t in templates
                              option(value=t.id_template data-contenido=t.contenido_template) #{t.nombre_template}
                    .mb-3
                      label(for="evolucion", class="form-label") Evolución:
                      textarea#evolucion.form-control(name="evolucion" placeholder="Describir evolución del paciente" rows="3") 
                    h3.text-center Diagnostico:
                    .mb-3
                      label(for="diagnostico", class="form-label") Diagnóstico:
                      textarea#diagnostico.form-control(name="diagnostico" placeholder="Ingresar diagnóstico" rows="3")

                    .mb-3
                        label(for="estadoDiagnostico", class="form-label") Estado del Diagnóstico:
                        select#estadoDiagnostico.form-select(name="estadoDiagnostico")
                            option(value="Preliminar") Preliminar
                            option(value="Confirmado") Confirmado

                    h3.text-center Alergias:
                    .mb-3
                      label(for="alergia", class="form-label") Alergias:
                      textarea#diagnostico.form-control(name="alergia" placeholder="Ingresar alergia" rows="3")

                    .mb-3
                        label(for="estadoAlergia", class="form-label") Nivel de alergia:
                        select#estadoAlergia.form-select(name="estadoAlergia")
                            option(value="Preliminar") Normal
                            option(value="Confirmado") Leve
                            option(value="Confirmado") Alta

                    h3.text-center Antecedentes:
                    div#antecedentesContainer
                      .row.justify-content-center
                        .col-12.col-md-6
                          .d-flex.align-items-center.mb-3.justify-content-center
                            label(for="inicioAntecedentes", class="form-label me-2") Inicio:
                            input#inicioAntecedentes(type="date" name="inicioAntecedentes" class="form-control" style="width: 180px;")
                    
                        .col-12.col-md-6
                          .d-flex.align-items-center.mb-3.justify-content-center
                            label(for="finAntecedentes", class="form-label me-2") Fin:
                            input#finAntecedentes(type="date" name="finAntecedentes" class="form-control" style="width: 180px;")
                    
                      .mb-3
                        input#antecedentes.form-control(type="text" name="antecedentes" placeholder="Ingresar antecedentes")

                    h3.text-center Hábitos:
                    div#habitosContainer
                      .row.justify-content-center
                        .col-12.col-md-6
                          .d-flex.align-items-center.mb-3.justify-content-center
                            label(for="inicioHabitos", class="form-label me-2") Inicio:
                            input#inicioHabitos(type="date" name="inicioHabitos" class="form-control" style="width: 180px;")
                    
                        .col-12.col-md-6
                          .d-flex.align-items-center.mb-3.justify-content-center
                            label(for="finHabitos", class="form-label me-2") Fin:
                            input#finHabitos(type="date" name="finHabitos" class="form-control" style="width: 180px;")
                    
                      .mb-3
                        input#habitos.form-control(type="text" name="habitos" placeholder="Ingresar hábitos")

                    h3.text-center Medicamentos:
                    .mb-3
                    label(for="medicamento", class="form-label") Seleccionar medicamento:
                    select#medicamento.form-select(name="medicamento")
                      option(value="") Seleccionar medicamento
                      each m in medicamentos
                        option(value=m.id_medicamento ) #{m.nombre_medicamento}

                    button(type="submit", class="btn btn-primary") Guardar
