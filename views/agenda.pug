doctype html
html
  head
    title Agenda
    link(href="https://cdn.lineicons.com/4.0/lineicons.css", rel="stylesheet")
    link(href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css", rel="stylesheet")
    link(rel="stylesheet" href="css/styles.css")
    script(src="/js/frontConsulta.js") // Archivo JS para manejo dinámico
  body
    .container-fluid(style="background-image: url('images/background_modulos.png'); background-size: cover; background-attachment: fixed; min-height: 100vh;")
      .row
        .col-md-1
          include sidebar.pug

        .col-md-11(style="margin-left: 0;")
          .main.p-3
            h1.text-center Seleccionar una fecha
            // Input para seleccionar fecha
            input(type="date" id="fechaCalendario", class="form-control mb-4", onchange="fetchTurnos(this.value)")

            // Contenedor para mostrar los resultados
            h2.text-center Turnos para la fecha seleccionada
            div#resultadosContainer
              // Se mostrará aquí los turnos

            // Pasamos los turnos a una variable global accesible desde JavaScript
            script.
              function fetchTurnos(fecha) {
                fetch(`/api/turnos?fecha=${fecha}`)
                  .then(response => {
                    if (!response.ok) {
                      throw new Error('Network response was not ok');
                    }
                    return response.json();
                  })
                  .then(data => {
                    const container = document.getElementById('resultadosContainer');
                    container.innerHTML = ''; // Limpiar resultados anteriores

                    if (data && data.length > 0) {
                      const card = document.createElement('div');
                      card.className = 'card';
                      const cardBody = document.createElement('div');
                      cardBody.className = 'card-body';
                      const ul = document.createElement('ul');
                      ul.className = 'list-group';

                      data.forEach(turno => {
                        const li = document.createElement('li');
                        li.className = 'list-group-item';
                        li.innerHTML = `ID del turno: ${turno.numero_turno}<br>
                                        Fecha: ${turno.fecha}<br>
                                        Hora: ${turno.hora}<br>
                                        Motivo: ${turno.motivo_consulta}<br>
                                        Paciente: ${turno.dni_paciente}`;
                        ul.appendChild(li);
                      });

                      cardBody.appendChild(ul);
                      card.appendChild(cardBody);
                      container.appendChild(card);
                    } else {
                      container.innerHTML = '<div class="alert alert-warning">No se encontraron turnos para esta fecha.</div>';
                    }
                  })
                  .catch(error => {
                    console.error('Error fetching turnos:', error);
                    const container = document.getElementById('resultadosContainer');
                    container.innerHTML = '<div class="alert alert-danger">Ocurrió un error al cargar los turnos.</div>';
                  });
              }
